
R version 3.4.0 (2017-04-21) -- "You Stupid Darkness"
Copyright (C) 2017 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> args <- (commandArgs(trailingOnly = TRUE))
> for (i in 1:length(args)) {
+   eval(parse(text = args[[i]]))
+ }
> 
> print(cdnaquant)
[1] "salmon/cDNAncRNA/20151016.A-Cortex_RNA/quant.sf"
> print(cdsquant)
[1] "salmon/cds/20151016.A-Cortex_RNA/quant.sf"
> print(gtffile)
[1] "/home/Shared/data/annotation/Human/Ensembl_GRCh38.90/gtf/Homo_sapiens.GRCh38.90.gtf"
> print(tx2gene)
[1] "reference/Homo_sapiens.GRCh38.90_tx2gene.rds"
> print(bwfile)
[1] "STARbigwig/20151016.A-Cortex_RNA_Aligned.sortedByCoord.out.bw"
> print(outrds)
[1] "output/20151016.A-Cortex_RNA_cdna_vs_cds.rds"
> 
> suppressPackageStartupMessages(library(dplyr))
> suppressPackageStartupMessages(library(rtracklayer))
> suppressPackageStartupMessages(library(Gviz))
> source("Rscripts/plot_tracks.R")
> options(ucscChromosomeNames = FALSE)
> 
> ## Read cDNA quantifications
> cdna <- read.delim(cdnaquant, header = TRUE, as.is = TRUE)
> 
> ## Read CDS quantifications
> cds <- read.delim(cdsquant, header = TRUE, as.is = TRUE)
> 
> ## Read tx2gene
> tx2gene <- readRDS(tx2gene)
> 
> ## Add gene assignment
> cdna$gene <- tx2gene$gene[match(cdna$Name, tx2gene$tx)]
> cds$gene <- tx2gene$gene[match(cds$Name, tx2gene$tx)]
> 
> ## Calculate relative abundances
> cdna <- cdna %>% dplyr::group_by(gene) %>% 
+   dplyr::mutate(RelCount = NumReads/sum(NumReads))
> cds <- cds %>% dplyr::group_by(gene) %>% 
+   dplyr::mutate(RelCount = NumReads/sum(NumReads))
> 
> ## Find shared transcripts
> cdna <- cdna %>% dplyr::select(Name, gene, NumReads, RelCount) %>%
+   dplyr::rename(NumReadscDNA = NumReads, RelCountcDNA = RelCount)
> cds <- cds %>% dplyr::select(Name, gene, NumReads, RelCount) %>%
+   dplyr::rename(NumReadsCDS = NumReads, RelCountCDS = RelCount)
> 
> abundances <- dplyr::full_join(cdna, cds) %>% 
+   dplyr::mutate(MaxNumReads = pmax(NumReadscDNA, NumReadsCDS)) %>%
+   dplyr::group_by(gene) %>% 
+   dplyr::mutate(Ntx = length(gene)) %>%
+   dplyr::ungroup()
Joining, by = c("Name", "gene")
> 
> tophits <- abundances %>% dplyr::filter(MaxNumReads > 2000) %>% 
+   dplyr::filter(Ntx > 1) %>% 
+   dplyr::filter(abs(RelCountcDNA - RelCountCDS) > 0.9)
> 
> write.table(tophits, file = gsub("\\.rds$", "_topgenes.txt", outrds), row.names = FALSE,
+             col.names = TRUE, quote = FALSE, sep = "\t")
> 
> write.table(abundances %>% dplyr::filter(gene %in% unique(tophits$gene)) %>%
+               dplyr::arrange(gene), 
+             file = gsub("\\.rds$", "_topgenes_alltx.txt", outrds), row.names = FALSE,
+             col.names = TRUE, quote = FALSE, sep = "\t")
> 
> ## Plot coverage of top hits
> (geneids <- unique(gsub("\\.[0-9]+$", "", tophits$gene)))
  [1] "ENSG00000241978" "ENSG00000165516" "ENSG00000106665" "ENSG00000151322"
  [5] "ENSG00000115944" "ENSG00000169764" "ENSG00000170456" "ENSG00000164070"
  [9] "ENSG00000119314" "ENSG00000149177" "ENSG00000198466" "ENSG00000161016"
 [13] "ENSG00000160294" "ENSG00000156508" "ENSG00000169641" "ENSG00000164347"
 [17] "ENSG00000277086" "ENSG00000149485" "ENSG00000128272" "ENSG00000089335"
 [21] "ENSG00000022355" "ENSG00000174437" "ENSG00000116205" "ENSG00000184905"
 [25] "ENSG00000165410" "ENSG00000082153" "ENSG00000175745" "ENSG00000090554"
 [29] "ENSG00000197380" "ENSG00000122378" "ENSG00000223572" "ENSG00000112419"
 [33] "ENSG00000079246" "ENSG00000161057" "ENSG00000125743" "ENSG00000273841"
 [37] "ENSG00000160117" "ENSG00000154721" "ENSG00000113448" "ENSG00000081026"
 [41] "ENSG00000121741" "ENSG00000179981" "ENSG00000112096" "ENSG00000197734"
 [45] "ENSG00000109762" "ENSG00000160013" "ENSG00000132432" "ENSG00000135414"
 [49] "ENSG00000205323" "ENSG00000165152" "ENSG00000114544" "ENSG00000182670"
 [53] "ENSG00000122033" "ENSG00000157107" "ENSG00000055130" "ENSG00000100764"
 [57] "ENSG00000198728" "ENSG00000149639" "ENSG00000167526" "ENSG00000103510"
 [61] "ENSG00000186566" "ENSG00000185591" "ENSG00000131469" "ENSG00000173915"
 [65] "ENSG00000163041" "ENSG00000183495" "ENSG00000136448" "ENSG00000103275"
 [69] "ENSG00000115365" "ENSG00000180044" "ENSG00000198908" "ENSG00000110367"
 [73] "ENSG00000101126" "ENSG00000100883" "ENSG00000134986" "ENSG00000105063"
 [77] "ENSG00000100109" "ENSG00000157540" "ENSG00000182768" "ENSG00000164405"
 [81] "ENSG00000068120" "ENSG00000118058" "ENSG00000168309" "ENSG00000180901"
 [85] "ENSG00000141338" "ENSG00000134532" "ENSG00000188554" "ENSG00000185432"
 [89] "ENSG00000088899" "ENSG00000116678" "ENSG00000103512" "ENSG00000101158"
 [93] "ENSG00000154723" "ENSG00000185818" "ENSG00000136193" "ENSG00000206324"
 [97] "ENSG00000125834" "ENSG00000149932" "ENSG00000015568" "ENSG00000206286"
[101] "ENSG00000008118" "ENSG00000166432" "ENSG00000179454" "ENSG00000136950"
[105] "ENSG00000100442" "ENSG00000048540" "ENSG00000101542" "ENSG00000002549"
[109] "ENSG00000103811" "ENSG00000163788" "ENSG00000198932" "ENSG00000198663"
[113] "ENSG00000138378" "ENSG00000135392" "ENSG00000118518" "ENSG00000241343"
[117] "ENSG00000162704" "ENSG00000197852" "ENSG00000169499" "ENSG00000103316"
[121] "ENSG00000021300" "ENSG00000276155" "ENSG00000198356" "ENSG00000174748"
[125] "ENSG00000125354" "ENSG00000128585" "ENSG00000008282" "ENSG00000141068"
[129] "ENSG00000102385" "ENSG00000170624" "ENSG00000257218" "ENSG00000114805"
[133] "ENSG00000168036" "ENSG00000083845" "ENSG00000026025" "ENSG00000183258"
[137] "ENSG00000079308" "ENSG00000184110" "ENSG00000183307" "ENSG00000087111"
[141] "ENSG00000110321" "ENSG00000138685" "ENSG00000184743" "ENSG00000108774"
[145] "ENSG00000074706" "ENSG00000166710" "ENSG00000123106" "ENSG00000197982"
[149] "ENSG00000143819" "ENSG00000167615" "ENSG00000157601" "ENSG00000003147"
[153] "ENSG00000103415" "ENSG00000119801" "ENSG00000243678" "ENSG00000188467"
[157] "ENSG00000088986" "ENSG00000163001" "ENSG00000162599" "ENSG00000136541"
[161] "ENSG00000090520" "ENSG00000089289" "ENSG00000182899" "ENSG00000092203"
[165] "ENSG00000135821" "ENSG00000113387" "ENSG00000146574" "ENSG00000163032"
[169] "ENSG00000101407" "ENSG00000138185" "ENSG00000121864" "ENSG00000120899"
[173] "ENSG00000198646" "ENSG00000110880" "ENSG00000007237" "ENSG00000017797"
[177] "ENSG00000237765" "ENSG00000115738" "ENSG00000169813" "ENSG00000108381"
[181] "ENSG00000101439" "ENSG00000102226" "ENSG00000122958" "ENSG00000101460"
[185] "ENSG00000112679" "ENSG00000022277" "ENSG00000197956" "ENSG00000166073"
[189] "ENSG00000111716" "ENSG00000277586" "ENSG00000111674" "ENSG00000107742"
[193] "ENSG00000170871" "ENSG00000181222" "ENSG00000232804" "ENSG00000151461"
[197] "ENSG00000197147" "ENSG00000272391" "ENSG00000116106" "ENSG00000153130"
[201] "ENSG00000196369" "ENSG00000166402" "ENSG00000134343" "ENSG00000151067"
[205] "ENSG00000169992" "ENSG00000137824" "ENSG00000186416" "ENSG00000100219"
[209] "ENSG00000074211" "ENSG00000133134" "ENSG00000181061" "ENSG00000067048"
[213] "ENSG00000179195" "ENSG00000196950" "ENSG00000099219" "ENSG00000090238"
[217] "ENSG00000179010" "ENSG00000196507" "ENSG00000172465" "ENSG00000062650"
> 
> genemodels_exon <- create_genemodels(gtffile, seltype = "exon")
> genemodels_cds <- create_genemodels(gtffile, seltype = "CDS")
> 
> pdf(gsub("rds$", "pdf", outrds), width = 12, height = 8)
> for (gid in geneids) {
+   message(gid)
+   tryCatch({
+     plot_tracks(mygene = gid, genemodels = genemodels_exon, 
+                 genemodels2 = genemodels_cds, 
+                 gtf_file = NULL, rnaseq_datafiles = structure(bwfile, names = "s1"), 
+                 rnaseq_condition = structure("g1", names = "s1"), show_chr = NULL, 
+                 min_coord = NULL, max_coord = NULL, 
+                 pdf_filename = NULL, pdf_width = 7, pdf_height = 7)
+   }, error = function(e) message(e))
+ }
ENSG00000241978
ENSG00000165516
ENSG00000106665
ENSG00000151322
ENSG00000115944
ENSG00000169764
ENSG00000170456
ENSG00000164070
ENSG00000119314
ENSG00000149177
ENSG00000198466
ENSG00000161016
ENSG00000160294
ENSG00000156508
ENSG00000169641
ENSG00000164347
ENSG00000277086
solving row 1: range cannot be determined from the supplied arguments (too many NAs)ENSG00000149485
ENSG00000128272
ENSG00000089335
ENSG00000022355
ENSG00000174437
ENSG00000116205
ENSG00000184905
ENSG00000165410
ENSG00000082153
ENSG00000175745
ENSG00000090554
ENSG00000197380
ENSG00000122378
ENSG00000223572
ENSG00000112419
ENSG00000079246
ENSG00000161057
ENSG00000125743
ENSG00000273841
ENSG00000160117
ENSG00000154721
ENSG00000113448
ENSG00000081026
ENSG00000121741
ENSG00000179981
ENSG00000112096
ENSG00000197734
ENSG00000109762
ENSG00000160013
ENSG00000132432
ENSG00000135414
ENSG00000205323
ENSG00000165152
ENSG00000114544
ENSG00000182670
ENSG00000122033
ENSG00000157107
ENSG00000055130
ENSG00000100764
ENSG00000198728
ENSG00000149639
ENSG00000167526
ENSG00000103510
ENSG00000186566
ENSG00000185591
ENSG00000131469
ENSG00000173915
ENSG00000163041
ENSG00000183495
ENSG00000136448
ENSG00000103275
ENSG00000115365
ENSG00000180044
ENSG00000198908
ENSG00000110367
ENSG00000101126
ENSG00000100883
ENSG00000134986
ENSG00000105063
ENSG00000100109
ENSG00000157540
ENSG00000182768
ENSG00000164405
ENSG00000068120
ENSG00000118058
ENSG00000168309
ENSG00000180901
ENSG00000141338
ENSG00000134532
ENSG00000188554
ENSG00000185432
ENSG00000088899
ENSG00000116678
ENSG00000103512
ENSG00000101158
ENSG00000154723
ENSG00000185818
ENSG00000136193
ENSG00000206324
solving row 1: range cannot be determined from the supplied arguments (too many NAs)ENSG00000125834
ENSG00000149932
ENSG00000015568
ENSG00000206286
solving row 1: range cannot be determined from the supplied arguments (too many NAs)ENSG00000008118
ENSG00000166432
ENSG00000179454
ENSG00000136950
ENSG00000100442
ENSG00000048540
ENSG00000101542
ENSG00000002549
ENSG00000103811
ENSG00000163788
ENSG00000198932
ENSG00000198663
ENSG00000138378
ENSG00000135392
ENSG00000118518
ENSG00000241343
ENSG00000162704
ENSG00000197852
ENSG00000169499
ENSG00000103316
ENSG00000021300
ENSG00000276155
solving row 1: range cannot be determined from the supplied arguments (too many NAs)ENSG00000198356
ENSG00000174748
ENSG00000125354
ENSG00000128585
ENSG00000008282
ENSG00000141068
ENSG00000102385
ENSG00000170624
ENSG00000257218
ENSG00000114805
ENSG00000168036
ENSG00000083845
ENSG00000026025
ENSG00000183258
ENSG00000079308
ENSG00000184110
ENSG00000183307
ENSG00000087111
ENSG00000110321
ENSG00000138685
ENSG00000184743
ENSG00000108774
ENSG00000074706
ENSG00000166710
ENSG00000123106
ENSG00000197982
ENSG00000143819
ENSG00000167615
ENSG00000157601
ENSG00000003147
ENSG00000103415
ENSG00000119801
ENSG00000243678
ENSG00000188467
ENSG00000088986
ENSG00000163001
ENSG00000162599
ENSG00000136541
ENSG00000090520
ENSG00000089289
ENSG00000182899
ENSG00000092203
ENSG00000135821
ENSG00000113387
ENSG00000146574
ENSG00000163032
ENSG00000101407
ENSG00000138185
ENSG00000121864
ENSG00000120899
ENSG00000198646
ENSG00000110880
ENSG00000007237
ENSG00000017797
ENSG00000237765
ENSG00000115738
ENSG00000169813
ENSG00000108381
ENSG00000101439
ENSG00000102226
ENSG00000122958
ENSG00000101460
ENSG00000112679
ENSG00000022277
ENSG00000197956
ENSG00000166073
ENSG00000111716
ENSG00000277586
ENSG00000111674
ENSG00000107742
ENSG00000170871
ENSG00000181222
ENSG00000232804
solving row 1: range cannot be determined from the supplied arguments (too many NAs)ENSG00000151461
ENSG00000197147
ENSG00000272391
ENSG00000116106
ENSG00000153130
ENSG00000196369
ENSG00000166402
ENSG00000134343
ENSG00000151067
ENSG00000169992
ENSG00000137824
ENSG00000186416
ENSG00000100219
ENSG00000074211
ENSG00000133134
ENSG00000181061
ENSG00000067048
ENSG00000179195
ENSG00000196950
ENSG00000099219
ENSG00000090238
ENSG00000179010
ENSG00000196507
ENSG00000172465
ENSG00000062650
There were 40 warnings (use warnings() to see them)
> dev.off()
null device 
          1 
> 
> saveRDS(list(abundances = abundances, tophits = tophits), file = outrds)
> 
> sessionInfo()
R version 3.4.0 (2017-04-21)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 14.04.5 LTS

Matrix products: default
BLAS: /usr/local/R/R-3.4.0/lib/libRblas.so
LAPACK: /usr/local/R/R-3.4.0/lib/libRlapack.so

locale:
 [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       
 [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   
 [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          
[10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   

attached base packages:
 [1] grid      parallel  stats4    stats     graphics  grDevices utils    
 [8] datasets  methods   base     

other attached packages:
[1] bindrcpp_0.2         Gviz_1.20.0          rtracklayer_1.36.4  
[4] GenomicRanges_1.28.5 GenomeInfoDb_1.12.2  IRanges_2.10.3      
[7] S4Vectors_0.14.5     BiocGenerics_0.22.0  dplyr_0.7.4         

loaded via a namespace (and not attached):
 [1] httr_1.3.1                    Biobase_2.36.2               
 [3] AnnotationHub_2.8.2           bit64_0.9-7                  
 [5] splines_3.4.0                 shiny_1.0.5                  
 [7] Formula_1.2-2                 assertthat_0.2.0             
 [9] interactiveDisplayBase_1.14.0 latticeExtra_0.6-28          
[11] blob_1.1.0                    BSgenome_1.44.2              
[13] GenomeInfoDbData_0.99.0       Rsamtools_1.28.0             
[15] yaml_2.1.14                   RSQLite_2.0                  
[17] backports_1.1.1               lattice_0.20-35              
[19] biovizBase_1.24.0             glue_1.1.1                   
[21] digest_0.6.12                 RColorBrewer_1.1-2           
[23] XVector_0.16.0                checkmate_1.8.4              
[25] colorspace_1.3-2              httpuv_1.3.5                 
[27] htmltools_0.3.6               Matrix_1.2-11                
[29] plyr_1.8.4                    XML_3.98-1.9                 
[31] pkgconfig_2.0.1               biomaRt_2.32.1               
[33] zlibbioc_1.22.0               xtable_1.8-2                 
[35] scales_0.5.0                  BiocParallel_1.10.1          
[37] htmlTable_1.9                 tibble_1.3.4                 
[39] AnnotationFilter_1.0.0        ggplot2_2.2.1                
[41] GenomicFeatures_1.28.5        SummarizedExperiment_1.6.5   
[43] nnet_7.3-12                   lazyeval_0.2.0               
[45] mime_0.5                      survival_2.41-3              
[47] magrittr_1.5                  memoise_1.1.0                
[49] foreign_0.8-69                BiocInstaller_1.26.1         
[51] tools_3.4.0                   data.table_1.10.4            
[53] matrixStats_0.52.2            stringr_1.2.0                
[55] munsell_0.4.3                 cluster_2.0.6                
[57] DelayedArray_0.2.7            ensembldb_2.0.4              
[59] AnnotationDbi_1.38.2          Biostrings_2.44.2            
[61] compiler_3.4.0                rlang_0.1.2                  
[63] RCurl_1.95-4.8                dichromat_2.0-0              
[65] VariantAnnotation_1.22.3      htmlwidgets_0.9              
[67] bitops_1.0-6                  base64enc_0.1-3              
[69] gtable_0.2.0                  curl_2.8.1                   
[71] DBI_0.7                       R6_2.2.2                     
[73] GenomicAlignments_1.12.2      gridExtra_2.3                
[75] knitr_1.17                    bit_1.1-12                   
[77] bindr_0.1                     Hmisc_4.0-3                  
[79] ProtGenerics_1.8.0            stringi_1.1.5                
[81] Rcpp_0.12.13                  rpart_4.1-11                 
[83] acepack_1.4.1                
> date()
[1] "Fri Feb  2 00:26:44 2018"
> 
> proc.time()
    user   system  elapsed 
1080.991    9.110 1096.205 
